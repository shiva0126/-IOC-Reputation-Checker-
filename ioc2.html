<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IOC Reputation Checker</title>
    <!-- Load Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure Tailwind to use 'Inter' font and extend colors -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'slate-950': '#0f172a',
                    }
                }
            }
        }
    </script>
    <style>
        /* Apply smooth scrolling and Inter font globally */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Load React and Babel for JSX support -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useRef } = React;

        // --- ICON COMPONENT DEFINITIONS (Replacement for Lucide-React) ---
        const Icon = ({ children, className = "w-5 h-5" }) => (
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                strokeWidth="2"
                strokeLinecap="round"
                strokeLinejoin="round"
                className={className}
            >
                {children}
            </svg>
        );

        const Shield = (props) => <Icon {...props} className="w-12 h-12 text-purple-400"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></Icon>;
        const Upload = (props) => <Icon {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></Icon>;
        const FileText = (props) => <Icon {...props}><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></Icon>;
        const AlertCircle = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></Icon>;
        const CheckCircle = (props) => <Icon {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></Icon>;
        const Download = (props) => <Icon {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></Icon>;
        const Activity = (props) => <Icon {...props}><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></Icon>;
        const Search = (props) => <Icon {...props}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></Icon>;
        const Loader = (props) => <Icon {...props}><path d="M12 2v4"/><path d="m16.2 7.8 2.5-2.5"/><path d="M22 12h-4"/><path d="m16.2 16.2 2.5 2.5"/><path d="M12 22v-4"/><path d="m7.8 16.2-2.5 2.5"/><path d="M2 12h4"/><path d="m7.8 7.8-2.5-2.5"/></Icon>;
        const Info = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></Icon>;

        // --- MAIN COMPONENT AND LOGIC ---

        const IOCReputationChecker = () => {
          const [apiKeys, setApiKeys] = useState({
            virustotal: '',
            abuseipdb: '',
            alienvault_otx: '',
            threatfox: ''
          });
          const [file, setFile] = useState(null);
          const [processing, setProcessing] = useState(false);
          const [progress, setProgress] = useState(0);
          const [results, setResults] = useState(null);
          const [summary, setSummary] = useState(null);
          const [error, setError] = useState('');
          const fileInputRef = useRef(null);

          // Detects the type of IOC (hash, IPv4, domain, unknown)
          const detectIOCType = (ioc) => {
            try {
              ioc = ioc.trim().toLowerCase();

              // Hash detection
              if (ioc.length === 32 && /^[a-f0-9]+$/.test(ioc)) return 'md5';
              if (ioc.length === 40 && /^[a-f0-9]+$/.test(ioc)) return 'sha1';
              if (ioc.length === 64 && /^[a-f0-9]+$/.test(ioc)) return 'sha256';

              // IPv4 detection
              const ipv4Pattern = /^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/;
              const ipMatch = ioc.match(ipv4Pattern);
              if (ipMatch) {
                const parts = ipMatch.slice(1, 5).map(p => parseInt(p));
                if (parts.every(part => part >= 0 && part <= 255)) {
                  return 'ipv4';
                }
              }

              // Domain detection (simple check)
              if (ioc.includes('.') && !ioc.includes(' ') && !ioc.includes('/') && ioc.split('.').length >= 2) {
                return 'domain';
              }

              return 'unknown';
            } catch (err) {
              console.error('Error detecting IOC type:', err);
              return 'unknown';
            }
          };

          // Calculates a weighted risk score based on mock API results
          const calculateRiskScore = (vtResult, abuseResult, otxResult, tfResult) => {
            let riskScore = 0;
            const factors = [];
            try {
              // VirusTotal (Max 1.0)
              if (vtResult?.threat_score !== undefined && vtResult.threat_score !== null) {
                riskScore += vtResult.threat_score / 100;
                factors.push(`VT: ${vtResult.threat_score}%`);
              }
              // AbuseIPDB (Max 1.0)
              if (abuseResult?.abuse_confidence_score !== undefined && abuseResult.abuse_confidence_score !== null) {
                riskScore += abuseResult.abuse_confidence_score / 100;
                factors.push(`Abuse: ${abuseResult.abuse_confidence_score}%`);
              }
              // AlienVault OTX (Max 1.0 - capped at 10 pulses)
              if (otxResult?.pulse_count !== undefined && otxResult.pulse_count !== null) {
                const pulseRisk = Math.min(otxResult.pulse_count / 10, 1);
                riskScore += pulseRisk;
                factors.push(`OTX: ${otxResult.pulse_count} pulses`);
              }
              // ThreatFox (Add 1.0 if an active threat is found)
              if (tfResult?.threat_type && tfResult.status !== 'not_found') {
                riskScore += 1;
                factors.push(`ThreatFox: ${tfResult.threat_type}`);
              }

              let riskLevel, recommendation, color;
              if (riskScore >= 2.0) {
                riskLevel = 'HIGH';
                recommendation = 'BLOCK IMMEDIATELY';
                color = 'text-red-600';
              } else if (riskScore >= 1.0) {
                riskLevel = 'MEDIUM';
                recommendation = 'INVESTIGATE/MONITOR';
                color = 'text-yellow-600';
              } else {
                riskLevel = 'LOW';
                recommendation = 'ALLOW';
                color = 'text-green-600';
              }

              return { riskScore, riskLevel, recommendation, factors, color };
            } catch (err) {
              console.error('Error calculating risk score:', err);
              return {
                 riskScore: 0,
                 riskLevel: 'UNKNOWN',
                 recommendation: 'ERROR',
                 factors: [],
                 color: 'text-gray-600'
               };
            }
          };

          // Mock API call simulation
          const mockAPICall = async (ioc, iocType, platform) => {
            try {
              // Simulate network delay
              await new Promise(resolve => setTimeout(resolve, 100 + Math.random() * 200));

              const randomScore = Math.random();

              if (platform === 'virustotal') {
                const malicious = Math.floor(randomScore * 15);
                const suspicious = Math.floor(randomScore * 8);
                const totalEngines = 70;
                return {
                  malicious,
                  suspicious,
                  undetected: totalEngines - malicious - suspicious,
                  harmless: 0,
                  total_engines: totalEngines,
                  threat_score: Math.round(((malicious + suspicious * 0.5) / totalEngines) * 100)
                };
              }

              if (platform === 'abuseipdb' && iocType === 'ipv4') {
                return {
                  abuse_confidence_score: Math.floor(randomScore * 100),
                  total_reports: Math.floor(randomScore * 50),
                  country_code: ['US', 'CN', 'RU', 'DE', 'UK', 'FR', 'NL'][Math.floor(Math.random() * 7)],
                  isp: ['Amazon', 'Cloudflare', 'Digital Ocean', 'OVH', 'Hetzner'][Math.floor(Math.random() * 5)],
                  is_whitelisted: randomScore < 0.1
                };
              }

              if (platform === 'otx') {
                return {
                  pulse_count: Math.floor(randomScore * 25),
                  reputation: Math.floor(randomScore * 100) - 50,
                  malware_families: randomScore > 0.6 ? ['Emotet', 'TrickBot'].slice(0, Math.ceil(randomScore * 2)) : []
                };
              }

              if (platform === 'threatfox') {
                if (randomScore > 0.75) {
                  const threats = ['botnet_cc', 'payload_delivery', 'c2_server'];
                  const malwares = ['Emotet', 'TrickBot', 'Qakbot', 'IcedID'];
                  return {
                    threat_type: threats[Math.floor(Math.random() * threats.length)],
                    malware: malwares[Math.floor(Math.random() * malwares.length)],
                    confidence_level: 50 + Math.floor(randomScore * 50),
                    tags: ['malware', 'botnet']
                  };
                }
                return { status: 'not_found' };
              }

              return {};
            } catch (err) {
              console.error(`Error in ${platform} API call:`, err);
              return { error: err.message };
            }
          };

          // Main processing loop for all IOCs
          const processIOCs = async (iocs) => {
            const results = [];
            const stats = {
              total: iocs.length,
              high: 0,
              medium: 0,
              low: 0,
              unknown: 0,
              byType: {}
            };
            for (let i = 0; i < iocs.length; i++) {
              try {
                const ioc = iocs[i];
                const iocType = detectIOCType(ioc);

                stats.byType[iocType] = (stats.byType[iocType] || 0) + 1;

                // Simulate parallel API calls
                const [vtResult, abuseResult, otxResult, tfResult] = await Promise.all([
                    mockAPICall(ioc, iocType, 'virustotal'),
                    iocType === 'ipv4' ? mockAPICall(ioc, iocType, 'abuseipdb') : Promise.resolve({}),
                    mockAPICall(ioc, iocType, 'otx'),
                    mockAPICall(ioc, iocType, 'threatfox')
                ]);

                const risk = calculateRiskScore(vtResult, abuseResult, otxResult, tfResult);

                if (risk.riskLevel === 'HIGH') stats.high++;
                else if (risk.riskLevel === 'MEDIUM') stats.medium++;
                else if (risk.riskLevel === 'LOW') stats.low++;
                else stats.unknown++;

                results.push({
                  ioc,
                  type: iocType,
                  virustotal: vtResult || {},
                  abuseipdb: abuseResult || {},
                  otx: otxResult || {},
                  threatfox: tfResult || {},
                  risk
                });

                setProgress(Math.round(((i + 1) / iocs.length) * 100));
              } catch (err) {
                console.error(`Error processing IOC ${iocs[i]}:`, err);
              }
            }
            return { results, stats };
          };

          const handleFileUpload = (e) => {
            try {
              setError('');
              const uploadedFile = e.target.files[0];
              if (uploadedFile) {
                if (uploadedFile.size > 5 * 1024 * 1024) { // 5MB limit
                  setError('File too large. Maximum size is 5MB.');
                  return;
                }
                setFile(uploadedFile);
                setResults(null); // Clear old results
                setSummary(null);
              }
            } catch (err) {
              setError('Error uploading file: ' + err.message);
            }
          };

          const handleProcess = async () => {
            if (!file) {
              setError('Please upload a file first');
              return;
            }
            setProcessing(true);
            setProgress(0);
            setError('');
            try {
              const text = await file.text();
              const iocs = text.split('\n')
                .map(line => line.trim())
                .filter(line => line && !line.startsWith('#') && line.length > 0);

              if (iocs.length === 0) {
                setError('No valid IOCs found in file');
                setProcessing(false);
                return;
              }
              if (iocs.length > 1000) {
                setError('Too many IOCs. Maximum is 1000 per file.');
                setProcessing(false);
                return;
              }

              const { results, stats } = await processIOCs(iocs);

              setResults(results);
              setSummary(stats);
            } catch (err) {
              setError('Error processing file: ' + err.message);
              console.error('Processing error:', err);
            } finally {
              setProcessing(false);
            }
          };

          const exportToCSV = () => {
            if (!results) return;
            try {
              const headers = [
                'IOC', 'Type', 'VT_Threat_Score', 'VT_Malicious', 'VT_Suspicious',
                'VT_Total_Engines', 'AbuseIPDB_Score', 'AbuseIPDB_Reports',
                'OTX_Pulse_Count', 'OTX_Reputation', 'ThreatFox_Threat_Type',
                'Risk_Level', 'Risk_Score', 'Recommendation'
              ];
              const escapeCSV = (val) => {
                if (val === null || val === undefined) return 'N/A';
                const str = String(val);
                if (str.includes(',') || str.includes('"') || str.includes('\n')) {
                  return `"${str.replace(/"/g, '""')}"`;
                }
                return str;
              };
              const rows = results.map(r => [
                escapeCSV(r.ioc),
                escapeCSV(r.type),
                escapeCSV(r.virustotal.threat_score),
                escapeCSV(r.virustotal.malicious),
                escapeCSV(r.virustotal.suspicious),
                escapeCSV(r.virustotal.total_engines),
                escapeCSV(r.abuseipdb.abuse_confidence_score),
                escapeCSV(r.abuseipdb.total_reports),
                escapeCSV(r.otx.pulse_count),
                escapeCSV(r.otx.reputation),
                escapeCSV(r.threatfox.threat_type || 'CLEAN'),
                escapeCSV(r.risk.riskLevel),
                escapeCSV(r.risk.riskScore.toFixed(2)),
                escapeCSV(r.risk.recommendation)
              ]);
              const csvContent = [
                headers.join(','),
                ...rows.map(row => row.join(','))
              ].join('\n');
              const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
              const url = window.URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = `ioc_reputation_report_${new Date().getTime()}.csv`;
              document.body.appendChild(a);
              a.click();
              document.body.removeChild(a);
              window.URL.revokeObjectURL(url);
            } catch (err) {
              setError('Error exporting CSV: ' + err.message);
            }
          };

          const exportDetailedReport = () => {
            if (!results) return;
            try {
              let report = '='.repeat(80) + '\n';
              report += 'IOC REPUTATION ANALYSIS - DETAILED REPORT\n';
              report += '='.repeat(80) + '\n\n';
              report += `Generated: ${new Date().toLocaleString()}\n`;
              report += `Total IOCs Analyzed: ${summary.total}\n\n`;
              report += 'SUMMARY\n';
              report += '-'.repeat(80) + '\n';
              report += `High Risk: ${summary.high} (${((summary.high/summary.total)*100).toFixed(1)}%)\n`;
              report += `Medium Risk: ${summary.medium} (${((summary.medium/summary.total)*100).toFixed(1)}%)\n`;
              report += `Low Risk: ${summary.low} (${((summary.low/summary.total)*100).toFixed(1)}%)\n\n`;
              report += 'IOC TYPE DISTRIBUTION\n';
              report += '-'.repeat(80) + '\n';
              Object.entries(summary.byType).forEach(([type, count]) => {
                report += `${type.toUpperCase()}: ${count}\n`;
              });
              report += '\n';
              report += 'DETAILED ANALYSIS\n';
              report += '='.repeat(80) + '\n\n';
              results.forEach((r, idx) => {
                report += `[${idx + 1}] ${r.ioc}\n`;
                report += `Type: ${r.type.toUpperCase()}\n`;
                report += `Risk Level: ${r.risk.riskLevel} (Score: ${r.risk.riskScore.toFixed(2)} - Factors: ${r.risk.factors.join(', ')})\n`;
                report += `Recommendation: ${r.risk.recommendation}\n\n`;
                report += 'VirusTotal:\n';
                report += `  Threat Score: ${r.virustotal.threat_score || 'N/A'}%\n`;
                report += `  Detections: ${r.virustotal.malicious || 0}/${r.virustotal.total_engines || 0} malicious\n\n`;
                if (r.type === 'ipv4' && r.abuseipdb.abuse_confidence_score !== undefined) {
                  report += 'AbuseIPDB:\n';
                  report += `  Abuse Score: ${r.abuseipdb.abuse_confidence_score}%\n`;
                  report += `  Reports: ${r.abuseipdb.total_reports}\n`;
                  report += `  Country: ${r.abuseipdb.country_code || 'N/A'}\n`;
                  report += `  ISP: ${r.abuseipdb.isp || 'N/A'}\n\n`;
                }
                report += 'AlienVault OTX:\n';
                report += `  Pulses: ${r.otx.pulse_count || 0}\n`;
                report += `  Reputation: ${r.otx.reputation || 'N/A'}\n`;
                if (r.otx.malware_families && r.otx.malware_families.length > 0) {
                    report += `  Malware Families: ${r.otx.malware_families.join(', ')}\n`;
                }
                report += '\n';
                if (r.threatfox.threat_type) {
                  report += 'ThreatFox:\n';
                  report += `  Threat Type: ${r.threatfox.threat_type}\n`;
                  report += `  Malware: ${r.threatfox.malware}\n`;
                  report += `  Confidence: ${r.threatfox.confidence_level}%\n\n`;
                }
                report += '-'.repeat(80) + '\n\n';
              });

              const blob = new Blob([report], { type: 'text/plain;charset=utf-8;' });
              const url = window.URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = `ioc_detailed_report_${new Date().getTime()}.txt`;
              document.body.appendChild(a);
              a.click();
              document.body.removeChild(a);
              window.URL.revokeObjectURL(url);
            } catch (err) {
              setError('Error exporting detailed report: ' + err.message);
            }
          };

          return (
            <div className="min-h-screen bg-slate-950 p-4 sm:p-6 font-sans">
              <div className="max-w-7xl mx-auto">
                {/* Header */}
                <div className="text-center mb-8">
                  <div className="flex items-center justify-center gap-3 mb-4">
                    <Shield />
                    <h1 className="text-3xl sm:text-4xl font-extrabold text-white">IOC Reputation Checker</h1>
                  </div>
                  <p className="text-purple-200 text-sm sm:text-base">
                    Multi-platform threat intelligence analysis with automated reporting (MD5, SHA1, SHA256, IP, Domain)
                  </p>
                  <div className="mt-2 flex items-center justify-center gap-2 text-xs sm:text-sm text-purple-300">
                    <Info className="w-3 h-3 sm:w-4 sm:h-4" />
                    <span>Demo mode: Using simulated threat intelligence data</span>
                  </div>
                </div>

                {/* Error Display */}
                {error && (
                  <div className="bg-red-500/20 border border-red-500/50 rounded-xl p-4 mb-6 flex items-start gap-3">
                    <AlertCircle className="w-5 h-5 text-red-400 flex-shrink-0 mt-0.5" />
                    <div className="text-red-200 text-sm">{error}</div>
                  </div>
                )}

                {/* API Keys Section (Kept for UI context, but non-functional in demo) */}
                <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 mb-6 border border-white/20 shadow-lg">
                  <h2 className="text-xl font-semibold text-white mb-4 flex items-center gap-2">
                    <Activity className="w-5 h-5" />
                    API Configuration (Demo Only)
                  </h2>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {Object.keys(apiKeys).map(key => (
                      <div key={key}>
                        <label className="block text-xs font-medium text-purple-200 mb-1">
                          {key.split('_').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ')}
                        </label>
                        <input
                          type="password"
                          value={apiKeys[key]}
                          onChange={(e) => setApiKeys({...apiKeys, [key]: e.target.value})}
                          placeholder="API key (not used in demo)"
                          className="w-full px-4 py-2 bg-white/5 border border-white/20 rounded-lg text-white text-sm placeholder-purple-300/50 focus:outline-none focus:border-purple-400 transition"
                        />
                      </div>
                    ))}
                  </div>
                </div>

                {/* File Upload Section */}
                <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 mb-6 border border-white/20 shadow-lg">
                  <h2 className="text-xl font-semibold text-white mb-4 flex items-center gap-2">
                    <Upload className="w-5 h-5" />
                    Upload IOC File
                  </h2>
                  <div className="flex flex-col sm:flex-row items-center justify-between gap-4">
                    <input
                      ref={fileInputRef}
                      type="file"
                      accept=".txt,.csv"
                      onChange={handleFileUpload}
                      className="hidden"
                    />
                    <div className="flex flex-col sm:flex-row items-center gap-3 w-full sm:w-auto">
                        <button
                            onClick={() => fileInputRef.current?.click()}
                            disabled={processing}
                            className="flex items-center justify-center gap-2 px-6 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 text-white rounded-xl font-medium transition-colors w-full sm:w-48 shadow-md hover:shadow-purple-500/50"
                        >
                            <FileText className="w-5 h-5" />
                            Choose File
                        </button>
                        {file ? (
                          <div className="flex items-center gap-2 text-green-400 text-sm font-medium w-full sm:w-auto p-2 bg-green-500/10 rounded-lg">
                            <CheckCircle className="w-5 h-5 flex-shrink-0" />
                            <span className="truncate">{file.name} ({(file.size / 1024).toFixed(1)} KB)</span>
                          </div>
                        ) : (
                           <div className="text-purple-300 text-sm p-2 w-full sm:w-auto">No file selected.</div>
                        )}
                    </div>
                    <button
                      onClick={handleProcess}
                      disabled={!file || processing}
                      className="px-8 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 disabled:from-gray-600 disabled:to-gray-700 text-white rounded-xl font-semibold transition-all disabled:cursor-not-allowed flex items-center justify-center gap-2 w-full sm:w-64 shadow-xl hover:shadow-pink-500/50"
                    >
                      {processing ? (
                        <>
                          <Loader className="w-5 h-5 animate-spin" />
                          Processing... {progress}%
                        </>
                      ) : (
                        <>
                          <Search className="w-5 h-5" />
                          Start Analysis
                        </>
                      )}
                    </button>
                  </div>
                </div>

                {/* Progress Bar */}
                {processing && (
                  <div className="bg-white/10 backdrop-blur-sm rounded-xl p-4 mb-6 border border-white/20">
                    <div className="w-full bg-white/10 rounded-full h-3">
                      <div
                         className="bg-gradient-to-r from-purple-500 to-pink-500 h-3 rounded-full transition-all duration-300"
                        style={{ width: `${progress}%` }}
                      />
                    </div>
                    <div className="text-center text-purple-200 text-sm mt-2">
                      Analyzing IOCs... {progress}%
                    </div>
                  </div>
                )}

                {/* Summary */}
                {summary && (
                  <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 mb-6 border border-white/20 shadow-lg">
                    <h2 className="text-2xl font-bold text-white mb-4">Analysis Summary</h2>
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                      <div className="bg-white/5 rounded-xl p-4 border border-white/10 text-center">
                        <div className="text-purple-200 text-sm mb-1">Total IOCs</div>
                        <div className="text-3xl font-bold text-white">{summary.total}</div>
                      </div>
                      <div className={`rounded-xl p-4 text-center ${summary.high > 0 ? 'bg-red-500/20 border border-red-500/30' : 'bg-white/5 border border-white/10'}`}>
                        <div className="text-red-200 text-sm mb-1">High Risk</div>
                        <div className="text-3xl font-bold text-red-400">{summary.high}</div>
                      </div>
                      <div className={`rounded-xl p-4 text-center ${summary.medium > 0 ? 'bg-yellow-500/20 border border-yellow-500/30' : 'bg-white/5 border border-white/10'}`}>
                        <div className="text-yellow-200 text-sm mb-1">Medium Risk</div>
                        <div className="text-3xl font-bold text-yellow-400">{summary.medium}</div>
                      </div>
                      <div className={`rounded-xl p-4 text-center ${summary.low > 0 && summary.high === 0 && summary.medium === 0 ? 'bg-green-500/20 border border-green-500/30' : 'bg-white/5 border border-white/10'}`}>
                        <div className="text-green-200 text-sm mb-1">Low Risk</div>
                        <div className="text-3xl font-bold text-green-400">{summary.low}</div>
                      </div>
                    </div>

                    <div className="mb-6">
                      <h3 className="text-white font-semibold mb-2">IOC Type Distribution</h3>
                      <div className="flex flex-wrap gap-2">
                        {Object.entries(summary.byType).map(([type, count]) => (
                          <div key={type} className="bg-purple-600/20 px-3 py-1 rounded-full text-purple-200 text-xs font-mono border border-purple-500/50">
                            {type.toUpperCase()}: {count}
                          </div>
                        ))}
                      </div>
                    </div>

                    <div className="flex flex-wrap gap-3">
                      <button
                        onClick={exportToCSV}
                        className="flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium text-sm shadow-md"
                      >
                        <Download className="w-4 h-4" />
                        Export CSV
                      </button>
                      <button
                        onClick={exportDetailedReport}
                        className="flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors font-medium text-sm shadow-md"
                      >
                        <FileText className="w-4 h-4" />
                        Export Detailed Report
                      </button>
                    </div>
                  </div>
                )}

                {/* Results */}
                {results && (
                  <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20 shadow-lg">
                    <h2 className="text-2xl font-bold text-white mb-4">Detailed Results ({results.length} IOCs)</h2>
                    <div className="space-y-4 max-h-[600px] overflow-y-auto pr-2">
                      {results.map((result, idx) => (
                        <div key={idx} className="bg-slate-800/50 rounded-xl p-4 border border-white/10 hover:bg-slate-800 transition-colors shadow-md">
                          <div className="flex items-start justify-between mb-3">
                            <div className="flex-1 min-w-0">
                              <div className="text-white font-mono text-base sm:text-lg mb-1 break-all font-semibold">{result.ioc}</div>
                              <div className="text-purple-300 text-xs">{result.type.toUpperCase()}</div>
                            </div>
                            <div className={`px-3 py-1 rounded-full text-sm font-bold ml-3 flex-shrink-0 border ${
                              result.risk.riskLevel === 'HIGH' ? 'bg-red-500/20 text-red-300 border-red-500/30' :
                              result.risk.riskLevel === 'MEDIUM' ? 'bg-yellow-500/20 text-yellow-300 border-yellow-500/30' :
                              'bg-green-500/20 text-green-300 border-green-500/30'
                            }`}>
                              {result.risk.riskLevel}
                            </div>
                          </div>

                          <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mt-3 pt-3 border-t border-white/10">
                            {/* VirusTotal */}
                            <div className="p-2 bg-white/5 rounded-lg">
                              <div className="text-purple-300 mb-1 font-medium">VirusTotal</div>
                              <div className="text-white font-bold">{result.virustotal.threat_score || 0}% Threat</div>
                              <div className="text-purple-200 text-xs">{result.virustotal.malicious || 0} Malicious</div>
                            </div>
                            {/* AbuseIPDB */}
                            {result.type === 'ipv4' && result.abuseipdb.abuse_confidence_score !== undefined && (
                              <div className="p-2 bg-white/5 rounded-lg">
                                <div className="text-purple-300 mb-1 font-medium">AbuseIPDB</div>
                                <div className="text-white font-bold">{result.abuseipdb.abuse_confidence_score}% Score</div>
                                <div className="text-purple-200 text-xs">{result.abuseipdb.total_reports} Reports</div>
                              </div>
                            )}
                            {/* AlienVault */}
                            <div className="p-2 bg-white/5 rounded-lg">
                              <div className="text-purple-300 mb-1 font-medium">AlienVault OTX</div>
                              <div className="text-white font-bold">{result.otx.pulse_count || 0} Pulses</div>
                              <div className="text-purple-200 text-xs">Rep: {result.otx.reputation || 'N/A'}</div>
                            </div>
                            {/* ThreatFox */}
                            <div className="p-2 bg-white/5 rounded-lg">
                              <div className="text-purple-300 mb-1 font-medium">ThreatFox</div>
                              <div className="text-white font-bold truncate">
                                {result.threatfox.threat_type || 'Clean'}
                              </div>
                            </div>
                          </div>

                          <div className="mt-4 pt-4 border-t border-white/10">
                            <div className="text-purple-200 text-sm">
                              <span className="font-bold text-white">Recommendation:</span> {result.risk.recommendation}
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        };

        // Render the component
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<IOCReputationChecker />);
    </script>
</body>
</html>